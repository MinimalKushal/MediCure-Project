- hosts: all
  become: true
  connection: ssh
  tasks:
  - name: Yum update
    command: sudo yum update
  - name: Install Docker
    command: sudo yum install docker -y
  - name: Start Docker
    command: sudo service docker start
  - name: Download Minikube
    command: sudo curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-latest.x86_64.rpm
  - name: Install Minikube
    command: sudo rpm -Uvh minikube-latest.x86_64.rpm
  - name: Start Minikube
    command: minikube start --force
  - name: Add Kubectl Links 
    command: cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
             [kubernetes]
             name=Kubernetes
             baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\$basearch
             enabled=1
             gpgcheck=1
             gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
             EOF
  - name: Install Kubectl
    command: sudo yum install -y kubectl
  - name: Kuebctl Version
    command: kubectl version
  - name: Create Deployment
    command: sudo kubectl create deployment medicure --image=minimalkushal/medicure
  - name: Expose Medicure Project
    command: sudo kubectl expose deployment medicure --type=NodePort --port=8082
  - name: Port Forward
    command: kubectl port-forward service/hello-minikube 8082:8082
  - name: Get Services
    command: sudo kubectl get svc
    
